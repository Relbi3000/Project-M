# Deepcheck — Технико-организационный план (SmartEduDoc)

Дата: 2025-11-01
Версия: 0.1 (MVP)

## 1. Цель и задачи

Цель: создать надёжную и недорогую систему обнаружения deepfake видео/изображений и сгенерированной речи (deep voice), способную работать локально и масштабироваться с добавлением внешнего "второго мнения" по запросу.

Ключевые задачи:
- Быстрый MVP: локальная проверка аудио (AASIST) и базовая видео/изображение эвристика.
- Единый CLI/микросервис для анализа файлов и выдачи JSON-ответа.
- Экономичный fallback к платным API только для спорных случаев.
- Дорожная карта по улучшению качества (CNN, темпоральные модели, отчётность).

## 2. Краткая архитектура MVP

Компоненты:
- AudioDetector (локально, AASIST via speechbrain)
- VideoDetector (извлечение кадров, FaceExtractor, частотно-текстурная эвристика)
- FaceExtractor (facenet-pytorch MTCNN)
- Heuristics (FFT-высокие частоты, inconsistency глаз/рта)
- API Fallback (дешёвый внешний провайдер, включать только при низкой уверенности)
- CLI (единичная точка входа, JSON-ответ)

Взаимодействие:
1. Пользователь вызывает CLI `detect path/to/file`.
2. Локальные детекторы возвращают метки и вероятности.
3. При низкой уверенности запускается `api_fallback`.
4. Вывод в JSON (label, probabilities, faces_scored, note, api_fallback).

## 3. Контракт модулей (коротко)

AudioDeepfakeDetector.predict_file(path) -> dict
- вход: путь к файлу аудио
- выход: словарь с keys: type, path, label, score_raw, probabilities
- ошибки: FileNotFoundError для отсутствующего файла

VideoDeepfakeDetector.predict_file(path) -> dict
- вход: путь к видео
- выход: type, path, label, probabilities, faces_scored
- ошибки: FileNotFoundError

CheapApiFallback.check_media(path, media_type) -> dict
- вход: путь, тип media
- выход: used(bool), provider, label, confidence или reason

## 4. Оценка затрат и ресурсы

Бюджет MVP:
- Open-source локальные компоненты: 0 тг
- Внешние вызовы API: до ~3000 тг/мес (pay-as-you-go, при 10–30 запросов)
- Железо: CPU подходит; GPU ускорит загрузку моделей и инференс.

Инфраструктура:
- Развёртывание: локально на сервере/станции ML (Ubuntu/Windows), контейнеры optional
- Хранилище моделей: локальная папка `pretrained_models/`

## 5. Метрики качества и тестирование

Ключевые метрики:
- EER / AUC (для аудио и видео)
- Precision/Recall, F1 на целевых сценариях
- False positive rate для реальных видео (важно низкое значение)
- Latency (время обработки файла)

План тестирования:
- Собрать validation set (реальные, синтетические; разные языки/устройства)
- Калибровать пороги (threshold tuning)
- Написать unit тесты: импорт модулей, предсказание на синтетических/фиктивных примерах

## 6. Дорожная карта (этапы и сроки)

Фаза 0 — MVP (0–4 недели)
- Реализовать локальный CLI/модули (готово в коде MVP).
- Проверка работоспособности на 10–50 примерах.
- Документация и README.

Фаза 1 — Качество (4–12 недель)
- Сбор валидационной выборки в доменной области.
- Калибровка порогов и метрик.
- Подмена эвристики на pre-trained CNN (Xception/EfficientNet) для face forgery.
- ONNX-экспорт модели для улучшенной скорости.

Фаза 2 — Надёжность и масштаб (3–6 месяцев)
- Темпоральная агрегация (RNN/Transformer/attention по кадрам).
- REST API + очередь задач + документация для интеграции.
- Механизмы explainability (тепловые карты/частотные карты для кадров).

Фаза 3 — Продукт (6–12 месяцев)
- Интеграция с внешними провайдерами для арбитража (платные API).
- UI/портал для отчетов и ручной проверки.
- Мониторинг качества и сбора фидбека.

## 7. Риски и mitigations

Риск: ложные срабатывания на реальных видео
- Mitigation: калибровка порогов, temporal smoothing, human-in-the-loop.

Риск: устаревание эвристик и появления новых генеративных артефактов
- Mitigation: модульная архитектура, быстрая подмена модели, регулярное обновление бассейна весов.

Риск: зависимости на внешние API/квоты
- Mitigation: использовать API только как fallback, кэширование результатов.

Юридические/этич. риски: приватность, запись/хранение файлов
- Mitigation: хранить минимальные метаданные, шифрование, политика retention.

## 8. Команда и роли (минимум)

- Техлид / ML-инженер: модель аудио, калибровка
- CV-инженер: детекция лиц, CNN/temporal models
- Backend-разработчик: CLI → REST, интеграции
- QA / аналитик: метрики, валидация

## 9. Оценка усилий и примерная смета

MVP: 1 специалист (0.5–1 FTE) × 4 недели
Phase1: 1–2 специалиста × 2 months
Phase2+: команда 2–3 специалистов, инфраструктура, сторонние сервисы (оценки зависят от объёма)

Операционные расходы (годовые):
- Локальная эксплуатация: минимально
- API (fallback): ~3000 тг/мес по умолчанию

## 10. Next steps (конкретные задачи на ближайшую итерацию)

1. Подготовить валидационную выборку (10–100 видео + аудио).
2. Прогони MVP на выборке, собери метрики.
3. Калибруй пороги (low/uncertain/deepfake) и зафиксируй их в config.
4. Подключить pre-trained Xception/EfficientNet как опцию и провести A/B тест.
5. Добавить простые unit-тесты и CI проверку (lint и импорт модулей).

---

Файлы в репозитории:
- `deepcheck/` — исходники MVP
- `requirements.txt` — зависимости
- `README.md` — инструкции по запуску
- `TECH_ORG_PLAN.md` — этот документ

Если нужно, я преобразую этот документ в ваш SmartEduDoc-шаблон (Word/PDF) и дополню таблицами (EER/AUC), подробным бюджетом и Gantt-диаграммой по этапам.
